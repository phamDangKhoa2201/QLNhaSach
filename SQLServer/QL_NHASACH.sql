CREATE DATABASE QL_NHASACH
GO
USE QL_NHASACH

CREATE TABLE TACGIA
(
	MATG CHAR(15),
	TENTG NVARCHAR(70),
	CONSTRAINT PK_TACGIA PRIMARY KEY (MATG)
)

CREATE TABLE THELOAI
(
	MATL CHAR(15),
	TENTHELOAI NVARCHAR(100),
	CONSTRAINT PK_THELOAI PRIMARY KEY (MATL)
)


CREATE TABLE SACH
(
	MASACH CHAR(15),
	TENSACH NVARCHAR(100),
	MATG CHAR(15),
	MATL CHAR(15),
	NAMXB INT,
	GIABAN INT,
	SOLUONG INT,
	CONSTRAINT PK_SACH PRIMARY KEY(MASACH),
	CONSTRAINT FK_SACH_TACGIA FOREIGN KEY (MATG) REFERENCES TACGIA(MATG),
	CONSTRAINT FK_SACH_THELOAI FOREIGN KEY(MATL) REFERENCES THELOAI(MATL),
	CONSTRAINT CHK_GIABAN CHECK (GIABAN > 0)
)

CREATE TABLE NHACUNGCAP
(
	MANCC CHAR(15),
	TENCC NVARCHAR(200),
	DIACHI NVARCHAR(500),
	SDT CHAR(12),
	CONSTRAINT PK_NCC PRIMARY KEY (MANCC),
	--CONSTRAINT DF_DIACHINCC DEFAULT 'CHUA XAC DINH' FOR DIACHI,
	CONSTRAINT UNI_SDT UNIQUE (SDT)
)
ALTER TABLE NHACUNGCAP
ADD CONSTRAINT DF_DIACHINCC DEFAULT 'CHUA XAC DINH' FOR DIACHI;

CREATE TABLE KHACHHANG
(
	MAKH CHAR(15),
	TENKH NVARCHAR(70),
	DIACHI NVARCHAR(500),
	SDT CHAR(12),
	CONSTRAINT PK_MAKH PRIMARY KEY (MAKH),
	CONSTRAINT UNI_SDTKH UNIQUE (SDT),
)
ALTER TABLE KHACHHANG
ADD CONSTRAINT DF_DIACHIKH DEFAULT 'CHUA XAC DINH' FOR DIACHI;

CREATE TABLE HOADONNHAP
(
	MAHDN int identity(1,1),
	MANCC CHAR(15),
	NGAYNHAP DATE,
	CONSTRAINT PK_HOADONNHAP PRIMARY KEY (MAHDN),
	CONSTRAINT FK_HDN_NCC FOREIGN KEY (MANCC) REFERENCES NHACUNGCAP(MANCC)
)

CREATE TABLE CTHOADONNHAP
(
	MAHDN int ,
	MASACH CHAR(15),
	SOLUONG INT,
	DONGIA INT,
	TONGTIEN INT,
	CONSTRAINT PK_CTHDN PRIMARY KEY (MAHDN,MASACH),
	CONSTRAINT FK_CTHDN_HDN FOREIGN KEY(MAHDN) REFERENCES HOADONNHAP(MAHDN),
	CONSTRAINT FK_CTHDN_SACH FOREIGN KEY(MASACH) REFERENCES SACH(MASACH)
)

CREATE TABLE HOADONXUAT
(
	MAHDX int identity (1,1),
	MAKH CHAR(15),
	NGAYXUAT DATE,
	CONSTRAINT PK_HDX PRIMARY KEY (MAHDX),
	CONSTRAINT FK_HDX_KH FOREIGN KEY (MAKH) REFERENCES KHACHHANG(MAKH),
)

CREATE TABLE CTHOADONXUAT
(
	MAHDX int,
	MASACH CHAR(15),
	SOLUONG INT,
	DONGIA FLOAT,
	TONGTIEN FLOAT,
	CONSTRAINT PK_CTHDX PRIMARY KEY (MAHDX,MASACH),
	CONSTRAINT FK_CTHDX_HDX FOREIGN KEY(MAHDX) REFERENCES HOADONXUAT(MAHDX),
	CONSTRAINT FK_CTHDX_SACH FOREIGN KEY (MASACH) REFERENCES SACH(MASACH)
)


CREATE TABLE NGUOIDUNG
(
	HOTEN NVARCHAR(100),
	TAIKHOAN CHAR(100),
	MATKHAU CHAR(50),
	CCCD CHAR(14),
	SDT CHAR(12),
	GIOITINH NVARCHAR(7),
	CONSTRAINT UNI_CCCD UNIQUE (CCCD),
	CONSTRAINT UNI_SDTNV UNIQUE (SDT),
	CONSTRAINT CHK_PHAI CHECK (GIOITINH IN (N'Nam', N'Nữ')),
	CONSTRAINT PK_ADMIN PRIMARY KEY (TAIKHOAN)
)

 INSERT INTO NGUOIDUNG VALUES(N'Nguyễn Anh Dương','admin', '123456','23432412634','0837261222', N'Nam')


---------INSERT--------
INSERT INTO TACGIA VALUES ('TG001', N'Nguyễn Du')
INSERT INTO TACGIA VALUES ('TG002', N'Hồ Xuân Hương')
INSERT INTO TACGIA VALUES ('TG003', N'Xuân Diệu')
INSERT INTO TACGIA VALUES ('TG004', N'Hồ Chí Minh')
INSERT INTO TACGIA VALUES ('TGCXD', N'Chưa Xác Định')

INSERT INTO THELOAI VALUES ('TL001', N'Truyện ngắn')
INSERT INTO THELOAI VALUES ('TL002', N'Tự sự')
INSERT INTO THELOAI VALUES ('TL003', N'Thơ')
INSERT INTO THELOAI VALUES ('TL004', N'Văn Xuôi')
INSERT INTO THELOAI VALUES ('TLCXD', N'Chưa Xác Định')

select * from NHACUNGCAP
INSERT INTO NHACUNGCAP VALUES('NCC001', N'Hoa Hồng', N'Hà Nội', '0123456789' )
INSERT INTO NHACUNGCAP VALUES('NCC002', N'Quốc Thanh', N'Tp. HCM', '0987654321' )
INSERT INTO NHACUNGCAP VALUES('NCCCXD', N'Chưa Xác Định', N'Chưa xác định', '00000000000' )

select * from KHACHHANG
INSERT INTO KHACHHANG VALUES ('KH001', N'Nguyễn Thị Thủy', N'Quận 7, Tp.HCM','0189237123')
INSERT INTO KHACHHANG VALUES ('KH002', N'Nguyễn Hoàng Tiên', N'Quận 10, Tp.HCM','04124534242')
INSERT INTO KHACHHANG VALUES ('KHVL', N'Vãng Lai', N'CHUA XAC DINH','00000000000')

select * from SACH

INSERT INTO SACH VALUES('SA001', N'Truyện Kiều','TG001','TL001',1996,126,0)
INSERT INTO SACH VALUES('SA002', N'Biển','TG003','TL003',1998,75,0)
INSERT INTO SACH VALUES('SA003', N'Anh Thương Em Ngủ','TG003','TL003',2002,82,0)
INSERT INTO SACH VALUES('SA004', N'Trường Ca','TG003','TL004',2003,132,0)
INSERT INTO SACH VALUES('SA005', N'Miền Nam Nước Việt','TG003','TL004',1993,183,0)
INSERT INTO SACH VALUES('SA006', N'Bánh Trôi Nước','TG002','TL003',2007,52,0)
INSERT INTO SACH VALUES('SA007', N'Tự Tình 2','TG002','TL003',2006,48,0)
INSERT INTO SACH VALUES('SA008', N'Nhật Ký Trong Tù','TG004','TL003',1996,153,0)
INSERT INTO SACH VALUES('SA009', N'Tuyên Ngôn Độc Lập','TG004','TL002',1997,142,0)
INSERT INTO SACH VALUES('SA010', N'Độc Tiểu Thanh Ký','TG001','TL003',1998,194,0)
INSERT INTO SACH VALUES('SA011', N'Vọng Phu thạch','TG001','TL002',1993,132,0)
INSERT INTO SACH VALUES('SA012', N'Vở Dâu Tây','TGCXD','TLCXD',2015,6,0)
INSERT INTO SACH VALUES('SA013', N'Vở Conna','TGCXD','TLCXD',2017,7,0)
INSERT INTO SACH VALUES('SA014', N'Vở ABC','TGCXD','TLCXD',2018,9,0)


set dateformat dmy
insert into HOADONNHAP(MANCC,NGAYNHAP) values ('NCC001','30/11/2022')
insert into HOADONNHAP(MANCC,NGAYNHAP) values ('NCC001','1/12/2022')
insert into HOADONNHAP(MANCC,NGAYNHAP) values ('NCC001','1/11/2022')
insert into HOADONNHAP(MANCC,NGAYNHAP) values ('NCC002','2/11/2022')

----backup
BACKUP DATABASE QL_NHASACH
TO DISK ='E:\hk1 nam3\.net\doan\SQLServer\BACKUPNHASACH.bak'

----phục hồi
restore database QL_NHASACH
FROM DISK =''
